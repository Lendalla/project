<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta content="utf-8" name="charset"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Gen Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <style>
        /* === CSS เพิ่มเติม === */
        .chat-messages {
            overflow-y: auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
        }

        .message {
            background-color: #e2e8f0;
            color: #333;
            border-radius: 20px;
            padding: 10px 15px;
            margin-bottom: 10px;
            max-width: 80%;
            word-wrap: break-word;
            align-self: flex-start;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-message {
            background-color: #e0f7fa;
            align-self: flex-start;
        }

        .bot-info {
            background-color: #fff3cd;
            align-self: flex-start;
            font-size: 0.875rem;
            color: #85640a;
            border: 1px solid #ffe0b2;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .user-message {
            background-color: #dcedc8;
            align-self: flex-end;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 0.5rem;
            padding: 0.5rem 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.875rem;
            color: #333;
        }

        .dropdown-item:hover {
            background-color: #f0f0f0;
        }

        /* สไตล์สำหรับแสดงโค้ด */
        .code-block {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: "Courier New", Courier, monospace;
            font-size: 14px;
            color: #333;
        }

        .code-block code {
            display: block;
            white-space: pre-wrap;
        }

        .copy-button {
            cursor: pointer;
            color: #6b7280;
        }

        .copy-button:hover {
            color: #1f2937;
        }

        /* === Responsive Design สำหรับโทรศัพท์ === */
        @media (max-width: 768px) {
            .main-text {
                font-size: 2rem; /* ปรับขนาดฟอนต์ให้เล็กลง */
            }

            .chat-messages {
                padding: 10px; /* ลด padding */
                height: 70vh; /* ปรับความสูงของพื้นที่แชท */
            }

            .message {
                max-width: 90%; /* เพิ่มความกว้างของข้อความ */
                font-size: 14px; /* ปรับขนาดฟอนต์ */
            }

            .chat-input-area {
                padding: 8px; /* ลด padding */
                border-radius: 20px; /* ปรับขอบมน */
            }

            .user-input-field {
                font-size: 14px; /* ปรับขนาดฟอนต์ */
                padding: 8px 12px; /* ปรับ padding */
            }

            .bot-info-area {
                font-size: 12px; /* ปรับขนาดฟอนต์ */
                padding: 8px; /* ลด padding */
                margin-bottom: 8px; /* ลด margin */
            }

            .header-text {
                font-size: 16px; /* ปรับขนาดฟอนต์ */
            }

            .profile-icon {
                width: 30px; /* ปรับขนาดไอคอนโปรไฟล์ */
                height: 30px;
            }

            .code-block {
                padding: 10px; /* ลด padding */
            }

            .code-block pre {
                font-size: 12px; /* ปรับขนาดฟอนต์โค้ด */
            }

            footer {
                padding: 10px; /* ลด padding ของ footer */
            }

            /* ปรับขนาดและระยะห่างของ icon ส่งข้อความ */
            .magic-button {
                font-size: 20px; /* ปรับขนาดไอคอน */
                margin: 0 8px; /* ปรับระยะห่าง */
            }
        }
    </style>
</head>
<body class="bg-white flex flex-col items-center justify-between h-screen">
    <header class="w-full flex items-center justify-between p-4 relative">
        <i class="fas fa-comment text-xl text-gray-500"></i>
        <div class="text-center header-text">
            <button id="gemini-button" class="focus:outline-none">
                <h1 class="text-lg font-semibold gemini-name">
                    Gen
                    <i class="fas fa-caret-down"></i>
                </h1>
            </button>
            <div id="dropdown-menu" class="dropdown-menu">
                <div class="dropdown-item" data-model-version="2o">2o</div>
            </div>
        </div>
        <img alt="User profile picture" class="rounded-full w-10 h-10 profile-icon" height="40" src="https://storage.googleapis.com/a1aa/image/IJ0Kysu0pUVIUynS8aWpNgPxTDxC-Pn6tBf31Hl7arI.jpg" width="40"/>
    </header>
    <main id="chat-messages" class="chat-messages flex-grow flex items-center justify-center">
        <h2 class="text-4xl font-semibold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 main-text">
            Hello
        </h2>
    </main>
    <footer class="w-full p-4">
        <div class="bg-blue-100 text-gray-700 text-center p-2 rounded-lg mb-4 bot-info-area">
            Gen 2o
        </div>
        <div class="flex items-center border rounded-full p-2 chat-input-area">
            <input class="flex-grow outline-none px-4 user-input-field" placeholder="Ask Gen" type="text" id="user-input"/>
            <i class="fas fa-magic text-xl text-gray-500 mx-2 magic-button" id="send-icon"></i>
        </div>
    </footer>

    <script>
        const apiKey = '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'; // API key ของคุณ
        const userInput = document.getElementById('user-input');
        const chatMessages = document.getElementById('chat-messages');
        const mainTextElement = document.querySelector('.main-text');
        const chatInputArea = document.querySelector('.chat-input-area');
        const botInfoArea = document.querySelector('.bot-info-area');
        const headerTextElement = document.querySelector('.header-text');
        const geminiButton = document.getElementById('gemini-button');
        const dropdownMenu = document.getElementById('dropdown-menu');
        const sendIcon = document.getElementById('send-icon');

        let currentModelVersion = "2o"; // Default version

        geminiButton.addEventListener('click', function(event) {
            dropdownMenu.classList.toggle('show');
            event.stopPropagation();
        });

        dropdownMenu.addEventListener('click', function(event) {
            if (event.target.classList.contains('dropdown-item')) {
                const selectedVersion = event.target.dataset.modelVersion;
                currentModelVersion = selectedVersion;
                dropdownMenu.classList.remove('show');
            }
        });

        document.addEventListener('click', function(event) {
            if (!geminiButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
                dropdownMenu.classList.remove('show');
            }
        });

        sendIcon.addEventListener('click', sendMessage);

        userInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
                event.preventDefault();
            }
        });

        async function sendMessage() {
            const messageText = userInput.value;
            if (!messageText) return;

            addUserMessage(messageText);
            userInput.value = '';

            if (mainTextElement) {
                mainTextElement.style.display = 'none';
            }
            if (chatMessages) {
                chatMessages.classList.remove('items-center', 'justify-center');
                chatMessages.classList.add('items-start', 'justify-start');
            }
            if (headerTextElement) {
                headerTextElement.classList.remove('text-center');
                headerTextElement.classList.add('text-left');
            }

            const botResponse = await getBotResponse(messageText);
            addBotMessage(botResponse);
        }

        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'user-message');
            messageElement.innerHTML = `<p>${message}</p>`;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function addBotMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'bot-message');

            // ตรวจสอบว่าข้อความมีโค้ดหรือไม่
            if (message.includes("```")) {
                const codeContent = extractCode(message);
                messageElement.innerHTML = `
                    <div class="code-block">
                        <div class="flex justify-between items-center mb-2">
                            <h1 class="text-lg font-semibold text-gray-900"># ตัวอย่างโค้ด</h1>
                            <button class="copy-button text-gray-500 hover:text-gray-700" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i> Copy code
                            </button>
                        </div>
                        <pre class="bg-gray-100 p-4 rounded-lg overflow-x-auto">
                            <code class="text-sm">${codeContent}</code>
                        </pre>
                    </div>
                `;
            } else {
                messageElement.innerHTML = `<p>${message}</p>`;
            }

            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function extractCode(message) {
            const codeRegex = /```[\s\S]*?```/g;
            const matches = message.match(codeRegex);
            if (matches) {
                return matches[0].replace(/```/g, '').trim();
            }
            return message;
        }

        function copyCode(button) {
            const codeElement = button.closest('.code-block').querySelector('code');
            const textToCopy = codeElement.innerText;
            navigator.clipboard.writeText(textToCopy).then(() => {
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    button.innerHTML = '<i class="fas fa-copy"></i> Copy code';
                }, 2000);
            });
        }

        async function getBotResponse(message) {
            const apiUrl = 'https://api.groq.com/openai/v1/chat/completions';
            const modelName = "qwen-2.5-32b";

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'Groq-Api-Key': apiKey
                    },
                    body: JSON.stringify({
                        "messages": [{"role": "user", "content": message}],
                        "model": modelName,
                        "temperature": 0.6,
                        "max_tokens": 4096,
                        "top_p": 0.95,
                        "stream": false
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const responseData = await response.json();
                const botReply = responseData.choices[0].message.content;
                return botReply || "เกิดข้อผิดพลาดในการรับข้อความตอบกลับ";
            } catch (error) {
                console.error('เกิดข้อผิดพลาดในการเรียก API:', error);
                return "ไม่สามารถเชื่อมต่อกับ AI ได้ในขณะนี้";
            }
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>
