<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chatai Artis E.05</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
        }
        .chat-container {
            width: 100%;
            height: 90%;
            max-width: 1500px;
            margin: auto;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative; /* Allow positioning of elements */
        }
        .model-select {
            position: absolute; /* Position the selector */
            top: 10px;
            left: 10px;
            padding: 5px 15px; /* More padding for better appearance */
            border-radius: 5px;
            border: 1px solid #007bff;
            cursor: pointer;
            background: #fff;
            user-select: none; /* Prevent text selection */
            transition: background 0.3s ease; /* Smooth background transition */
        }
        .model-select.active {
            background: #e0e0e0; /* Background color when active */
        }
        .model-options {
            display: none; /* Hide options initially */
            position: absolute;
            top: 45px; /* Position below the selector */
            left: 10px; /* Position to the right of ArtisX with 25px gap */
            background: #fff;
            border: 1px solid #007bff;
            border-radius: 5px;
            z-index: 10; /* Ensure it appears above other elements */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Add shadow for depth */
        }
        .model-options.show {
            display: block; /* Show options when 'show' class is added */
        }
        .model-options select {
            border: none; /* Remove border from select */
            background: transparent; /* Make background transparent */
            padding: 10px; /* Add padding */
            width: 100%; /* Full width */
            appearance: none; /* Remove default arrow */
            font-size: 16px; /* Increase font size */
            cursor: pointer;
        }
        .model-options select:focus {
            outline: none; /* Remove outline on focus */
        }
        .chat-box {
            padding: 10px;
            height: calc(100% - 150px); /* Adjust height to account for the model selector */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            position: relative;
            margin-top: 50px; /* Push chat box below the model selector */
        }
        .user-input {
            display: flex;
            border-top: 1px solid #e9e9e9;
            padding: 10px;
            background: #e9e9e9;
            height: 60px;
        }
        .user-input textarea {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            margin-right: 10px;
            resize: none; /* Disable resizing */
            height: 40px; /* Set fixed height */
            text-align: left; /* Align text to the left */
            animation: typing 0.5s ease; /* Add typing animation */
        }
        @keyframes typing {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }
        .user-input button {
            width: 50px; /* Set width for circular button */
            height: 50px; /* Set height for circular button */
            border-radius: 50%; /* Make the button circular */
            background: #007bff; /* Button color */
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.5s ease; /* Added background transition */
        }
        .user-input button:hover {
            background: #D4D4D4; /* Change background color on hover */
        }
        .user-input button.loading {
            animation: spin 1s linear infinite; /* Add loading animation */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .user-input button img {
            width: 24px;
            height: auto;
        }
        .message {
            margin: 10px 0;
            opacity: 0;
            transition: opacity 0.5s ease;
            display: flex;
            align-items: center;
        }
        .user-message {
            justify-content: flex-end;
        }
        .bot-message {
            color: #007bff;
        }
        .icon {
            width: 20px;
            height: auto;
            margin-right: 5px;
        }
        .user-message .icon {
            margin-left: 5px;
        }
        .typing-indicator {
            display: inline-block;
            animation: typing 1.5s steps(5, end) infinite;
        }
        @keyframes typing {
            0% { content: "กำลังคิด..."; }
            25% { content: "กำลังคิด.."; }
            50% { content: "กำลังคิด."; }
            75% { content: "กำลังคิด.."; }
            100% { content: "กำลังคิด..."; }
        }
        canvas {
            margin-top: 10px;
            border: 1px solid #ccc;
            display: none; /* Hide by default */
        }
        .tab {
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            padding: 10px;
            background: #e9e9e9;
        }
        .tab.active {
            font-weight: bold;
            background: #d3d3d3;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<div class="chat-container">
    <div class="model-select" id="model-selector" onclick="toggleModelSelect()">
        ArtisX
    </div>
    <div class="model-options" id="model-options">
        <select onchange="selectModel()">
            <option value="typhoon-v1.5-instruct">v1.5-instruct</option>
            <option value="typhoon-v1.5-instruct-fc" disabled>v1.5-instruct-fc</option> <!-- Locked option -->
        </select>
    </div>
    <div class="chat-box" id="chat-box"></div>
    <div class="user-input">
        <textarea id="user-message" placeholder="พิมพ์ข้อความที่นี่..." onkeypress="checkEnter(event)"></textarea>
        <button id="send-button" onclick="sendMessage()">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/send.png" alt="Send Icon" />
        </button>
    </div>
    <div class="tab" onclick="toggleCodeTab()">แสดงโค้ด</div>
    <canvas id="codeCanvas" width="580" height="300"></canvas>
</div>

<script>
    let typingIndicator;
    let codeVisible = false;

    function toggleModelSelect() {
        const modelOptions = document.getElementById('model-options');
        const modelSelector = document.getElementById('model-selector');
        modelOptions.classList.toggle('show'); // Toggle the visibility of options
        
        // Toggle background color for the ArtisX button
        modelSelector.classList.toggle('active');
    }

    async function sendMessage() {
        const userMessage = document.getElementById('user-message').value.trim();
        if (!userMessage) return;

        displayMessage(userMessage, 'user');
        document.getElementById('user-message').value = '';

        // Add loading animation to the button
        const sendButton = document.getElementById('send-button');
        sendButton.classList.add('loading');

        displayTypingIndicator();

        try {
            const model = document.querySelector('#model-options select').value; // Get selected model
            const response = await axios.post('https://api.opentyphoon.ai/v1/chat/completions', {
                "model": model,
                "max_tokens": 512,
                "messages": [
                    { role: "system", content: "You are ArtisX, a large language model trained by SCB And Padlojh. Your goal is to assist with helpful, informative, and friendly responses. Always adapt to the user's tone, be conversational, and provide clear and concise answers. Avoid giving medical, legal, or financial advice." },
                    { role: "user", content: userMessage }
                ],
                "temperature": 0.4,
                "top_p": 0.9,
                "top_k": 0,
                "repetition_penalty": 1.05,
                "min_p": 0.05
            }, {
                headers: {
                    Authorization: 'Bearer sk-frn8Q6cNenIlNT0oSmOJ1HVnSIrnjB3c6XKv12xeoSMNFx45'
                }
            });

            const botResponse = response.data.choices[0].message.content;
            displayMessage(botResponse, 'bot'); // Show message immediately without animation
            resetScroll();
        } catch (error) {
            console.error('Error fetching data from Chatai:', error);
            displayMessage('ขอโทษ นั่นนอกเหนือขอบเขตการตอบของเรา', 'bot');
        } finally {
            sendButton.classList.remove('loading'); // Remove loading animation
            hideTypingIndicator();
        }
    }

    function selectModel() {
        const selectedModel = document.querySelector('#model-options select').value;
        console.log("Selected model: " + selectedModel);
        toggleModelSelect(); // Hide options after selection
    }

    function isCode(response) {
        return response.includes('function') || response.includes('{') || response.includes('}');
    }

    function displayCode(code) {
        const canvas = document.getElementById('codeCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear previous content
        
        ctx.fillStyle = "#fff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = "#000";
        ctx.font = "16px monospace";
        ctx.fillText("นี่คือโค้ดของคุณ:", 10, 20);
        
        // Format code as a block
        const formattedCode = `\`\`\`python\n${code}\n\`\`\``; // Wrap code in markdown format
        const lines = formattedCode.split('\n');
        lines.forEach((line, index) => {
            ctx.fillText(line, 10, 50 + index * 20);
        });

        // Display the canvas
        canvas.style.display = 'block'; 
    }

    function toggleCodeTab() {
        codeVisible = !codeVisible;
        const canvas = document.getElementById('codeCanvas');
        canvas.style.display = codeVisible ? 'block' : 'none';
    }

    function checkEnter(event) {
        // Only send message if Enter is pressed without Shift
        if (event.key === 'Enter' && !event.shiftKey) {
            sendMessage();
            event.preventDefault(); // Prevent the default action (new line)
        }
    }

    function displayTypingIndicator() {
        typingIndicator = document.createElement('div');
        typingIndicator.className = 'message bot-message typing-indicator';
        typingIndicator.innerHTML = '<span>กำลังคิด...</span>';
        document.getElementById('chat-box').appendChild(typingIndicator);
        
        setTimeout(() => {
            typingIndicator.style.opacity = 1;
        }, 10);
    }

    function hideTypingIndicator() {
        if (typingIndicator) {
            typingIndicator.style.opacity = 0;
            setTimeout(() => {
                typingIndicator.remove();
            }, 500);
        }
    }

    function displayMessage(message, sender) {
        const chatBox = document.getElementById('chat-box');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;

        const icon = sender === 'user'
            ? '<img class="icon" src="https://cdn.discordapp.com/attachments/1332945987525673000/1333804012423872614/user.jpg?ex=679a3949&is=6798e7c9&hm=f2e2df8c0c4c2192cbb29972ff4aa927112652798daa72ccd3a1939a119ffef8&" alt="User Icon" />' 
            : '<img class="icon" src="https://cdn.discordapp.com/attachments/1332945987525673000/1333803468955324486/logfav.png?ex=679a38c7&is=6798e747&hm=17d8b597e55aa56fb7c4ee6ad5ed9e63ca0b1a2da3c781cdc652961a4aabec8d&" alt="Chatai Icon" />';

        if (sender === 'user') {
            messageDiv.innerHTML = message + icon;
        } else {
            messageDiv.innerHTML = icon + message;
        }

        chatBox.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.style.opacity = 1;
        }, 10);
    }

    function resetScroll() {
        const chatBox = document.getElementById('chat-box');
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

</body>
</html>